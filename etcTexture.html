<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenGL ES SDK for Android: ETC2 Texture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function()
{ (i[r].q=i[r].q||[]).push(arguments)}
,i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35797182-1', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="top_banner.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenGL ES SDK for Android
<span id="armdevcenter"><a href="https://developer.arm.com/">ARM Developer Center</a></span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('etcTexture.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ETC2 Texture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Demonstration of ETC2 texture compression support in OpenGL ES 3.0.</p>
<h1><a class="anchor" id="etcTextureIntroduction"></a>
Introduction</h1>
<p>It is assumed that you have read and understood all of the mechanisms described in <a class="el" href="assetLoading.html">Asset Loading</a>,<a class="el" href="simpleTriangle.html">Simple Triangle</a> and <a class="el" href="textureCube.html">Texture Cube</a>.</p>
<h1><a class="anchor" id="etcTextureOverview"></a>
Overview</h1>
<div class="image">
<img src="ETC2TextureDemo_android.png" alt="ETC2TextureDemo_android.png"/>
<div class="caption">
The application cycles through all of the texture formats supported by OpenGL ES 3.0.</div></div>
<p> Compressed textures are loaded and displayed on the screen. The internal format of each texture is displayed at the bottom of the screen. The application cycles through all of the texture formats supported by OpenGL ES 3.0.</p>
<p>Formats:</p><ol type="1">
<li>GL_COMPRESSED_R11_EAC: 11 bits for a single channel. Useful for single channel data where higher than 8 bit precision is needed. For example, heightmaps.</li>
<li>GL_COMPRESSED_SIGNED_R11_EAC: Signed version of GL_COMPRESSED_SIGNED_R11_EAC, useful when signed data is needed.</li>
<li>GL_COMPRESSED_RG11_EAC: 11 bits for two channels. Useful for two channel data where higher than 8 bit precision is needed. For example, normalised bump maps, the third component can be reconstructed from the other two components.</li>
<li>GL_COMPRESSED_SIGNED_RG11_EAC: Signed version of GL_COMPRESSED_RG11_EAC, useful when signed data is needed.</li>
<li>GL_COMPRESSED_RGB8_ETC2: 8 bits for three channels. Useful for normal textures without alpha values.</li>
<li>GL_COMPRESSED_SRGB8_ETC2: sRGB version of GL_COMPRESSED_RGB8_ETC2.</li>
<li>GL_COMPRESSED_RGBA8_ETC2_EAC: 8 bits for four channels. Useful for normal textures with varying alpha values.</li>
<li>GL_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC: sRGB version of GL_COMPRESSED_RGBA8_ETC2_EAC.</li>
<li>GL_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2: 8 bits for three channels and a 1 bit alpha channel. Useful for normal textures with binary alpha values.</li>
<li>GL_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2: sRGB version of GL_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2.</li>
</ol>
<h1><a class="anchor" id="etcTextureGeneratingCompressedImages"></a>
Generating Compressed Images</h1>
<p>One of the possible ways of generating ETC2 images is to use the <em>ARM Mali Texture Compression Tool</em> which you can find here: <a href="http://malideveloper.arm.com">http://malideveloper.arm.com</a>. Once you have installed the tool, you can load any texture (stored in jpg, png or any other supported file formats). Then try to compress the image using the ETC2 compressor by selecting the compression format you are interested in. The result will be stored in a PKM file.</p>
<div class="image">
<img src="ETC2TextureDemo_TctCompression.png" alt="ETC2TextureDemo_TctCompression.png"/>
<div class="caption">
Generating compressed files using the ARM Mali Texture Compression Tool.</div></div>
<p> When you generate compressed textures, you can use them in the following steps.</p>
<h1><a class="anchor" id="etcTextureGCompressedTexturesRendering"></a>
Render Compressed Textures on a Screen</h1>
<p>In this section we will describe how to render a compressed texture onto the screen. For each ETC2 compression format supported by OpenGL ES 3.0, we will have a separate texture object. In the steps described below, we will however focus on dealing with a single texture object, as the same steps should be repeated for all the texture formats we want to display.</p>
<h2><a class="anchor" id="etcTextureGCompressedTexturesRendering_GenerateTexture"></a>
Generate Texture Object</h2>
<p>We need to start by generating a texture object ID.</p>
<div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGenTextures(1,            &amp;<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#aabb2bd74f989e48fe3d5d5cec061a492">imageArray</a>[textureIndex].<a class="code" href="tutorials_2_normal_mapping_2jni_2_native_8cpp.html#a748ff5115c8b3b65daec06945c822353">textureId</a>));</div></div><!-- fragment --><p> Once we get one, we need to bind it to the <em>GL_TEXTURE_2D</em> target.</p>
<div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindTexture(GL_TEXTURE_2D, <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#aabb2bd74f989e48fe3d5d5cec061a492">imageArray</a>[textureIndex].<a class="code" href="tutorials_2_normal_mapping_2jni_2_native_8cpp.html#a748ff5115c8b3b65daec06945c822353">textureId</a>));</div></div><!-- fragment --><p> It is important to set the texture object's parameters, so that the texture will be properly displayed on the screen.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Set parameters for a texture. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S,     GL_CLAMP_TO_EDGE));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T,     GL_CLAMP_TO_EDGE));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR));</div></div><!-- fragment --><p> Now, we fill the texture object with data.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Call CompressedTexImage2D() function which specifies texture with compressed image. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glCompressedTexImage2D(GL_TEXTURE_2D,</div><div class="line">                                    0,</div><div class="line">                                    <a class="code" href="gl2ext_8h.html#ab90692d7f8e57332a86e3885cdcfa784">internalformat</a>,</div><div class="line">                                    imageWidth,</div><div class="line">                                    imageHeight,</div><div class="line">                                    0,</div><div class="line">                                    <a class="code" href="gl2ext_8h.html#af17aef68eaddfa6109474d953fc65888">imageSize</a>,</div><div class="line">                                    imageData));</div></div><!-- fragment --><p> If the <em>internalformat</em> argument value is considered, you should use one of the ETC2 internalformats supported by OpenGL ES 3.0, which are listed below (which of course correspond to the internalformat of the compressed texture we are using here).</p>
<table class="doxtable">
<tr>
<th align="left">Compressed Internal Format </th><th align="left"><a class="el" href="struct_image.html">Image</a> Size  </th></tr>
<tr>
<td align="left">GL_COMPRESSED_R11_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_SIGNED_R11_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_RG11_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 16 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_SIGNED_RG11_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 16 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_RGB8_ETC2 </td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_SRGB8_ETC2 </td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_RGBA8_ETC2_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 16 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC </td><td align="left">ceil(width/4) * ceil(height/4) * 16 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2 </td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
<tr>
<td align="left">GL_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2</td><td align="left">ceil(width/4) * ceil(height/4) * 8 </td></tr>
</table>
<p>At this point there is one thing that is unclear: what values should be used for <em>imageWidth</em>, <em>imageHeight</em>, <em>imageSize</em>, <em>imageData</em> in <em>glCompressedTexImage2D()</em> call? Those values should correspond to the data retrieved from PKM file, as shown below.</p>
<div class="fragment"><div class="line">    Texture::loadPKMData(fileName, &amp;etcHeader, &amp;imageData);</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="keywordtype">int</span>     imageHeight = etcHeader.getHeight();</div><div class="line">    <span class="keywordtype">int</span>     imageWidth  = etcHeader.getWidth();</div><div class="line">    GLsizei <a class="code" href="gl2ext_8h.html#af17aef68eaddfa6109474d953fc65888">imageSize</a>   = etcHeader.getSize(<a class="code" href="gl2ext_8h.html#ab90692d7f8e57332a86e3885cdcfa784">internalformat</a>);</div></div><!-- fragment --> <h2><a class="anchor" id="etcTextureGCompressedTexturesRendering_LoadPkmData"></a>
Load PKM image data</h2>
<p>The very first thing you should do is to set the pixel storage mode so that the proper alignment will be used whilst reading the texture images.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Set OpenGL to use right alignment when reading texture images. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glPixelStorei(GL_UNPACK_ALIGNMENT, 1));</div></div><!-- fragment --><p> Then, you should open and read the PKM file as implemented in the functions presented below.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> Texture::loadPKMData(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, ETCHeader* etcHeader, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **<a class="code" href="_thread_sync_8cpp.html#a0a8264ad404efc50b85e91a9954c4ec0">textureData</a>)</div><div class="line">    {</div><div class="line">        <span class="comment">/* PKM file consists of a header with information about image (stored in 16 first bits) and image data. */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span>       sizeOfETCHeader = 16; </div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  tempTextureData = NULL;</div><div class="line"></div><div class="line">        <a class="code" href="namespace_astc_textures.html#ac2d4047f283f79b55953901f0f596e42">loadData</a>(filename, &amp;tempTextureData);</div><div class="line"></div><div class="line">        <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(textureData     != NULL, <span class="stringliteral">&quot;textureData is a NULL pointer.&quot;</span>);</div><div class="line">        <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(etcHeader       != NULL, <span class="stringliteral">&quot;etcHeader is a NULL pointer.&quot;</span>);</div><div class="line">        <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(tempTextureData != NULL, <span class="stringliteral">&quot;Could not load data from PKM file.&quot;</span>);</div><div class="line"></div><div class="line">        ETCHeader tempEtcHeader(tempTextureData);</div><div class="line"></div><div class="line">        *etcHeader   = tempEtcHeader;</div><div class="line">        *textureData = tempTextureData + sizeOfETCHeader;</div><div class="line">    }</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespace_astc_textures.html#ac2d4047f283f79b55953901f0f596e42">Texture::loadData</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **<a class="code" href="_thread_sync_8cpp.html#a0a8264ad404efc50b85e91a9954c4ec0">textureData</a>)</div><div class="line">    {</div><div class="line">        FILE *file = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(file == NULL)</div><div class="line">        {</div><div class="line">            <a class="code" href="_astc_textures_8h.html#ae02538a80ad5fc009caec73487d11a8d">LOGE</a>(<span class="stringliteral">&quot;Failed to open &#39;%s&#39;\n&quot;</span>, filename);</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line"></div><div class="line">        fseek(file, 0, SEEK_END);</div><div class="line"></div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   <a class="code" href="gl2ext_8h.html#ab9c919755bde3b34349e23a32b4e0fa7">length</a>        = ftell(file);</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *loadedTexture = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)calloc(length, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>));</div><div class="line"></div><div class="line">        <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(loadedTexture != NULL, <span class="stringliteral">&quot;Could not allocate memory to store PKM file data.&quot;</span>)</div><div class="line"></div><div class="line">        fseek(file, 0, SEEK_SET);</div><div class="line"></div><div class="line">        <span class="keywordtype">size_t</span> read = fread(loadedTexture, sizeof(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>), length, file);</div><div class="line"></div><div class="line">        <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(read == length, &quot;Failed to read PKM file.&quot;);</div><div class="line"></div><div class="line">        fclose(file);</div><div class="line"></div><div class="line">        *textureData = loadedTexture;</div><div class="line">    }</div></div><!-- fragment --><p> Once you get the result, you can use the retrieved data in the <em>glCompressedTexImage2D()</em> call as already mentioned in the previous section (<a class="el" href="etcTexture.html#etcTextureGCompressedTexturesRendering_GenerateTexture">Generate Texture Object</a>).</p>
<h2><a class="anchor" id="etcTextureGCompressedTexturesRendering_RenderTexture"></a>
Render texture on a screen</h2>
<p>In OpenGL ES, the basic geometry rendering technique is to render triangles. In our case, we want to render a simple quad onto which there will be a texture image applied.</p>
<p>The first step is to generate vertex coordinates of the triangles that make up the quad (please note that we are interested in a quad in XY space).</p>
<p>Please look at the image below. The schema show coordinates we are using in the application.</p>
<div class="image">
<img src="ETC2TextureDemo_Coordinates.png" alt="ETC2TextureDemo_Coordinates.png"/>
<div class="caption">
Quad coordinates (blue) and corresponding texture UVs (red).</div></div>
<p> This is defined as follows.</p>
<p>Coordinates of a triangles that are used to render a quad.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a02322a353dad4e5adfef1830d760ae46">vertexData</a>[] = {-1.0f, -1.0f, 0.0f,</div><div class="line">                       1.0f, -1.0f, 0.0f,</div><div class="line">                      -1.0f,  1.0f, 0.0f,</div><div class="line">                      -1.0f,  1.0f, 0.0f,</div><div class="line">                       1.0f, -1.0f, 0.0f,</div><div class="line">                       1.0f,  1.0f, 0.0f};</div></div><!-- fragment --><p> Corresponding texture UVs.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#abc47b0ff624a3cd850468ec973152574">textureCoordinatesData</a>[] = {0.0f, 1.0f,</div><div class="line">                                  1.0f, 1.0f,</div><div class="line">                                  0.0f, 0.0f,</div><div class="line">                                  0.0f, 0.0f,</div><div class="line">                                  1.0f, 1.0f,</div><div class="line">                                  1.0f, 0.0f};</div></div><!-- fragment --><p> We will need array buffer objects to store the coordinates described above.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Generate buffers. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGenBuffers(2,</div><div class="line">                          <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#abb9dc572e495e1309511e01b7821b58d">bufferObjectIds</a>));</div><div class="line"></div><div class="line">    <span class="comment">/* Fill buffer object with vertex data. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindBuffer(GL_ARRAY_BUFFER,</div><div class="line">                          <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#abb9dc572e495e1309511e01b7821b58d">bufferObjectIds</a>[0]));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBufferData(GL_ARRAY_BUFFER,</div><div class="line">                          <span class="keyword">sizeof</span>(vertexData),</div><div class="line">                          vertexData,</div><div class="line">                          GL_STATIC_DRAW));</div><div class="line"></div><div class="line">    <span class="comment">/* Fill buffer object with texture coordinates data. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindBuffer(GL_ARRAY_BUFFER,</div><div class="line">                          <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#abb9dc572e495e1309511e01b7821b58d">bufferObjectIds</a>[1]));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBufferData(GL_ARRAY_BUFFER,</div><div class="line">                          <span class="keyword">sizeof</span>(textureCoordinatesData),</div><div class="line">                          textureCoordinatesData,</div><div class="line">                          GL_STATIC_DRAW));</div></div><!-- fragment --><p> There is no OpenGL ES 3.0 rendering without program objects, so we should now focus on that. First of all, we need to:</p>
<ol type="1">
<li>create program object ID, <div class="fragment"><div class="line">    <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a> = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glCreateProgram());</div></div><!-- fragment --></li>
<li>create shader objects' IDs (should be called twice for <em>shaderType</em> equal to <em>GL_FRAGMENT_SHADER</em> and <em>GL_VERTEX_SHADER</em>), <div class="fragment"><div class="line">        *shaderObjectIdPtr = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glCreateShader(shaderType));</div></div><!-- fragment --></li>
<li>set shader source, <div class="fragment"><div class="line">        <a class="code" href="gl2ext_8h.html#a5dfa7628a601bf72d36273e52495a1db">strings</a>[0]         = <a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#aceb8b27cd7d369c524624ede81a1299e">loadShader</a>(filename);</div></div><!-- fragment --><div class="fragment"><div class="line">        <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glShaderSource(*shaderObjectIdPtr, 1, <a class="code" href="gl2ext_8h.html#a5dfa7628a601bf72d36273e52495a1db">strings</a>, NULL));</div></div><!-- fragment --></li>
<li>compile shader (it is always a good idea to check, whether the compilation succeeded: <em>GL_COMPILE_STATUS</em> set to <em>GL_TRUE</em>, <div class="fragment"><div class="line">        <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glCompileShader(*shaderObjectIdPtr));</div></div><!-- fragment --><div class="fragment"><div class="line">        <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGetShaderiv(*shaderObjectIdPtr, GL_COMPILE_STATUS, &amp;compileStatus));</div></div><!-- fragment --></li>
<li>attach shaders to program object, <div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glAttachShader(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#acc1eb33f2e499064566b78ec020099a4">vertexShaderId</a>));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glAttachShader(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#ab4fa89f786e9fe64ec88be5363d3e79c">fragmentShaderId</a>));</div></div><!-- fragment --></li>
<li>link program object, <div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glLinkProgram(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>));</div></div><!-- fragment --></li>
<li>use program. <div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glUseProgram(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>));</div></div><!-- fragment --> The shaders we are using are rather simple and self-explanatory</li>
</ol>
<p><a class="el" href="struct_vertex.html">Vertex</a> shader code: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;in        vec4 attributePosition;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;in        vec2 attributeTextureCoordinate;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;uniform   mat4 modelViewMatrix;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;out       vec2 varyingTextureCoordinate;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;void main()</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    varyingTextureCoordinate = attributeTextureCoordinate;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    gl_Position              = modelViewMatrix * attributePosition;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div></div><!-- fragment --><p> Fragment shader code</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;precision mediump float;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;uniform sampler2D uniformTexture;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;in      vec2      varyingTextureCoordinate;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;out     vec4      colour;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;void main()</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    colour = texture(uniformTexture, varyingTextureCoordinate);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div></div><!-- fragment --><p> The next step is to set values for the attributes and uniforms we are using in the shaders. To do that, we need to retrieve their locations. In the API, we are calling <em>glGetUniformLocation()</em> with the ID of a program and name of the uniform used in the shaders given as arguments. The analogous situation is to call <em>glGetAttribLocation()</em>, but this time we are using the attribute name instead.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Get attributes and uniforms locations from shaders attached to the program. */</span></div><div class="line">    <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#af53f4d326428188bc54a39a93b560e2d">modelViewMatrixLocation</a>   = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGetUniformLocation(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <span class="stringliteral">&quot;modelViewMatrix&quot;</span>));</div><div class="line">    <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#af8a637a06ae0f472dc72dcb013eee18a">positionLocation</a>          = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGetAttribLocation (<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <span class="stringliteral">&quot;attributePosition&quot;</span>));</div><div class="line">    <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#abffc939c432b4237f24800f9987b97fc">textureCoordinateLocation</a> = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGetAttribLocation (<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <span class="stringliteral">&quot;attributeTextureCoordinate&quot;</span>));</div><div class="line">    <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a9332784721badbc87398ddfc4d8dde9c">textureLocation</a>           = <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glGetUniformLocation(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a7b323a585c4b161fa33338ac823567df">programId</a>, <span class="stringliteral">&quot;uniformTexture&quot;</span>));</div></div><!-- fragment --><p> It is always a good idea to make sure that the uniform and attributes were found (which means that they are declared and used by the program object). If the returned value is equal to -1, then an attribute/uniform is considered inactive.</p>
<div class="fragment"><div class="line">    <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#af53f4d326428188bc54a39a93b560e2d">modelViewMatrixLocation</a>   != -1, <span class="stringliteral">&quot;Could not retrieve uniform location: modelViewMatrix.&quot;</span>);</div><div class="line">    <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(<a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#af8a637a06ae0f472dc72dcb013eee18a">positionLocation</a>          != -1, <span class="stringliteral">&quot;Could not retrieve attribute location: attributePosition.&quot;</span>);</div><div class="line">    <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#abffc939c432b4237f24800f9987b97fc">textureCoordinateLocation</a> != -1, <span class="stringliteral">&quot;Could not retrieve attribute location: attributeTextureCoordinate.&quot;</span>);</div><div class="line">    <a class="code" href="_compute_particles_2jni_2common_2common_8h.html#a9a90e23f0f81ce2fdf8c10979e6917fb">ASSERT</a>(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a9332784721badbc87398ddfc4d8dde9c">textureLocation</a>           != -1, <span class="stringliteral">&quot;Could not retrieve uniform location: uniformTexture.&quot;</span>);</div></div><!-- fragment --><p> Once we are sure that retrieved locations are valid, we can set values for the uniforms and attributes.</p>
<p>By calling </p><div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glUniform1i       (<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a9332784721badbc87398ddfc4d8dde9c">textureLocation</a>,</div><div class="line">                                0));</div></div><!-- fragment --><p>we are telling OpenGL ES to use a texture object that is currently bound to the <em>GL_TEXTURE_2D</em> target at the <em>GL_TEXTURE0</em> texture unit (if you are using GL_TEXTURE1 as the texture unit, the value for the uniform should equal 1) as an input to the program object.</p>
<p>We wanted the application to cycle through all of the texture formats supported by OpenGL ES 3.0, which is why we will be re-binding the textures many times. This is done as shown below.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Draw texture-mapped quad. */</span></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glActiveTexture(GL_TEXTURE0));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindTexture  (GL_TEXTURE_2D,</div><div class="line">                             <a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#aabb2bd74f989e48fe3d5d5cec061a492">imageArray</a>[<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#a17943e3ae2e4442f196197ef4ae73f85">currentAssetIndex</a>].<a class="code" href="tutorials_2_normal_mapping_2jni_2_native_8cpp.html#a748ff5115c8b3b65daec06945c822353">textureId</a>));</div></div><!-- fragment --><p> How do we set values for attributes? The best way is to use <em><a class="el" href="struct_vertex.html">Vertex</a> Attrib Arrays</em>. Do you remember the buffer objects we have created and filled with quad coordinates and texture UV data? We will use them now.</p>
<div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindBuffer             (GL_ARRAY_BUFFER,</div><div class="line">                                       <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#abb9dc572e495e1309511e01b7821b58d">bufferObjectIds</a>[0]));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glVertexAttribPointer    (<a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#af8a637a06ae0f472dc72dcb013eee18a">positionLocation</a>,</div><div class="line">                                       3,</div><div class="line">                                       GL_FLOAT,</div><div class="line">                                       GL_FALSE,</div><div class="line">                                       0,</div><div class="line">                                       0));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glEnableVertexAttribArray(<a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#af8a637a06ae0f472dc72dcb013eee18a">positionLocation</a>));</div><div class="line"></div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glBindBuffer             (GL_ARRAY_BUFFER,</div><div class="line">                                       <a class="code" href="tutorials_2_boids_2jni_2_native_8cpp.html#abb9dc572e495e1309511e01b7821b58d">bufferObjectIds</a>[1]));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glVertexAttribPointer    (<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#abffc939c432b4237f24800f9987b97fc">textureCoordinateLocation</a>,</div><div class="line">                                       2,</div><div class="line">                                       GL_FLOAT,</div><div class="line">                                       GL_FALSE,</div><div class="line">                                       0,</div><div class="line">                                       0));</div><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glEnableVertexAttribArray(<a class="code" href="tutorials_2_etc_texture_2jni_2_native_8cpp.html#abffc939c432b4237f24800f9987b97fc">textureCoordinateLocation</a>));</div></div><!-- fragment --><p> The last thing to do is to issue the draw call.</p>
<div class="fragment"><div class="line">    <a class="code" href="_astc_textures_8h.html#a410114caf210cb21e6c1701f04eb102d">GL_CHECK</a>(glDrawArrays(GL_TRIANGLES, 0, 6));</div></div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">
        <a class="copyright" href="http://www.arm.com/">(C) ARM Ltd. 2017</a>
    </li>
  </ul>
</div>
</body>
</html>
