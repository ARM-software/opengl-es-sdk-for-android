<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenGL ES SDK for Android: Asset Loading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function()
{ (i[r].q=i[r].q||[]).push(arguments)}
,i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35797182-1', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="top_banner.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenGL ES SDK for Android
<span id="armdevcenter"><a href="https://developer.arm.com/">ARM Developer Center</a></span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('asset_loading.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Asset Loading </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Using the Open Asset Importer to load models into OpenGL ES.</p>
<h1><a class="anchor" id="assetLoadingExampleIntroduction"></a>
Introduction</h1>
<p>The source for this sample can be found in the folder of the SDK.</p>
<p>In the tutorials so far all of the geometry for the scenes has been hand crafted and stored in the source files for the examples. We've hinted in previous tutorials that in the real-world, people use modeling tools to create their scenes. In this tutorial we'll show you how to load simple model files using the <a href="http://assimp.sourceforge.net/">Open Asset Importer library</a>.</p>
<h1><a class="anchor" id="assetLoadingNewProject"></a>
Setting up the Project</h1>
<p>For the tutorial, the <a class="el" href="simple_cube.html">Simple Cube</a> project will be used as a starting point. So either copy the project or create a completely new project and include the source files from the previous project. The project should be called <b>AssetLoading</b> and the package name should be called <em><a class="el" href="namespacecom_1_1arm_1_1malideveloper_1_1openglessdk_1_1assetloading.html">com.arm.malideveloper.openglessdk.assetloading</a></em>. Finally, the activity class (previously <em><a class="el" href="_simple_cube_8java.html">SimpleCube.java</a></em>) should be renamed <b><a class="el" href="_asset_loading_8java.html">AssetLoading.java</a></b> using Eclipse (this ensures references to the activity get updated elsewhere in the project).</p>
<h1><a class="anchor" id="assetLoadingPrebuilt"></a>
Using external libraries in Android</h1>
<p>In order to use the Open Asset Importer library we first need to build it for Android and then reference it as part of our build process. The Open Asset Importer library uses a CMake based build system which makes it easy to build for most platforms. To make things a bit easier we have provided a prebuilt version of the the Open Asset Importer library for Android and the required header files in the <em>assimp</em> folder of the tutorial. If you want to build the Open Asset Importer for Android yourself, there are a few tutorials and open source projects to add Android support to CMake available online.</p>
<p>To use this prebuilt library we have to tell CMake where to find the built library and its header files. The CMake code for importing the library look like this:</p>
<div class="fragment"><div class="line">        add_library(assimp SHARED IMPORTED)</div>
<div class="line">        set_property(TARGET assimp PROPERTY IMPORTED_LOCATION ${CMAKE_CURRENT_SOURCE_DIR}/assimp/libassimp.so)</div>
<div class="line">        target_include_directories(${sample} PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/assimp/include)</div>
<div class="line">        target_link_libraries(${sample} assimp)</div>
<div class="line">        add_custom_command(TARGET ${sample} POST_BUILD</div>
<div class="line">        COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/assimp/libassimp.so ${CMAKE_LIBRARY_OUTPUT_DIRECTORY})</div>
</div><!-- fragment --><p> The first line declares that the library already exists and so the build system knows it doesn't have to try and build it. The rest of the file describes the various parameters of a prebuilt library. It tells the CMake build system the name of the module (so we can reference it elsewhere), the name of the actually library file, and the location of the header files which any project using the library will need. Those header files will automatically get added to the include path of any project referencing this library.</p>
<p>You can use similar code to include other prebuilt libraries for CMake.</p>
<h1><a class="anchor" id="assetLoadingUsingAssimp"></a>
Using the Open Asset Importer library.</h1>
<p>The Open Asset Importer can load models store in a variety of different formats. It converts these to a standard internal format which we can access in a consistent manner. Different model formats can store a variety of different features, for example:</p>
<ul>
<li>Geometry</li>
<li>Normals</li>
<li>Textures</li>
<li>Materials</li>
<li>Bones</li>
<li>Animation</li>
</ul>
<p>For this tutorial we are going to focus on just geometry.</p>
<p>The Open Asset Importer loads the geometry into one or more meshes, and stores a list of faces which index into the geometry. This is very similar to how OpenGL ES works with glDrawElements, you give OpenGL ES a list of all the vertices you require and then give it a list of indices into that list to draw your polygons.</p>
<p>We will load the model in the <em>setupGraphics</em> function. First we pass in the data to the Open Asset Importer:</p>
<div class="fragment"><div class="line">    std::string <a class="code" href="_compute_particles_2jni_2app_8cpp.html#a1cdc3b21bbcb0647245cf0c880cffc7e">sphere</a> = <span class="stringliteral">&quot;s 0 0 0 10&quot;</span>;</div>
<div class="line">    <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a> = aiImportFileFromMemory(sphere.c_str(), sphere.length(), 0, <span class="stringliteral">&quot;.nff&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="jni_2_astc_textures_8h.html#ae02538a80ad5fc009caec73487d11a8d">LOGE</a>(<span class="stringliteral">&quot;Open Asset Importer could not load scene. \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --><p> The Open Asset Importer is capable of loading model files directly, however, because loading files on Android from native code is non-trivial, we are using a buffer instead. We define a buffer which represents a model file, pass that to the Open Asset Importer along with a hint to tell it which file format we are using. Here we are using the Neutral File Format (documentation can be found <a href="http://tog.acm.org/resources/SPD/NFF.TXT">here</a>). This particular buffer represents a sphere (s) at the origin (0 0 0) with radius 10.</p>
<p>After we've loaded a file into the Open Asset Importer, we simply extract all the vertices in the meshes into and array and then all the indices into another.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">int</span> vertices_accumulation = 0;</div>
<div class="line">    <span class="comment">/* Go through each mesh in the scene. */</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mNumMeshes; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Add all the vertices in the mesh to our array. */</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mMeshes[i]-&gt;mNumVertices; j++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> aiVector3D&amp; vector = <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mMeshes[i]-&gt;mVertices[j];</div>
<div class="line">            <a class="code" href="_cube_8h.html#aebc90711c5df16dd4e6faa8b261cd828">vertices</a>.push_back(vector.x);</div>
<div class="line">            <a class="code" href="_cube_8h.html#aebc90711c5df16dd4e6faa8b261cd828">vertices</a>.push_back(vector.y);</div>
<div class="line">            <a class="code" href="_cube_8h.html#aebc90711c5df16dd4e6faa8b261cd828">vertices</a>.push_back(vector.z);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Add all the indices in the mesh to our array.</span></div>
<div class="line"><span class="comment">         * Indices are listed in the Open Asset importer relative to the mesh they are in.</span></div>
<div class="line"><span class="comment">         * Because we are adding all vertices from all meshes to one array we must add an offset</span></div>
<div class="line"><span class="comment">         * to the indices to correct for this.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0 ; j &lt; <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mMeshes[i]-&gt;mNumFaces ; j++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> aiFace&amp; <a class="code" href="gl2ext_8h.html#a5be6a25280558430b19997fef84c4c31">face</a> = <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mMeshes[i]-&gt;mFaces[j];</div>
<div class="line">            <a class="code" href="gl2ext_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.push_back(face.mIndices[0] + vertices_accumulation);</div>
<div class="line">            <a class="code" href="gl2ext_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.push_back(face.mIndices[1] + vertices_accumulation);</div>
<div class="line">            <a class="code" href="gl2ext_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.push_back(face.mIndices[2] + vertices_accumulation);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Keep track of number of vertices loaded so far to use as an offset for the indices. */</span></div>
<div class="line">        vertices_accumulation += <a class="code" href="occlusion_8cpp.html#a6de66f9ad116ce1d596c7f4edc40c521">scene</a>-&gt;mMeshes[i]-&gt;mNumVertices;</div>
<div class="line">    }</div>
</div><!-- fragment --><p> If you want to load textures, animation, or any of the other advance features it is slightly more complex. Have a look a the Open Asset Importer documentation for more information.</p>
<p>We then pass these arrays to OpenGL ES in the <em>renderFrame</em> function:</p>
<div class="fragment"><div class="line">    glUseProgram(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#acc375d345c9a0f0d601530103fe293af">glProgram</a>);</div>
<div class="line">    <span class="comment">/* Use the vertex data loaded from the Open Asset Importer. */</span></div>
<div class="line">    glVertexAttribPointer(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#a83dd2521bc5a3e4938bf116aaa9b1328">vertexLocation</a>, 3, GL_FLOAT, GL_FALSE, 0, &amp;<a class="code" href="_cube_8h.html#aebc90711c5df16dd4e6faa8b261cd828">vertices</a>[0]);</div>
<div class="line">    glEnableVertexAttribArray(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#a83dd2521bc5a3e4938bf116aaa9b1328">vertexLocation</a>);</div>
<div class="line">    <span class="comment">/* We&#39;re using vertices as the colour data here for simplicity. */</span></div>
<div class="line">    glVertexAttribPointer(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#a7d1706924ffb7ffcda7ebb0c5bc7ff8d">vertexColourLocation</a>, 3, GL_FLOAT, GL_FALSE, 0, &amp;<a class="code" href="_cube_8h.html#aebc90711c5df16dd4e6faa8b261cd828">vertices</a>[0]);</div>
<div class="line">    glEnableVertexAttribArray(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#a7d1706924ffb7ffcda7ebb0c5bc7ff8d">vertexColourLocation</a>);</div>
<div class="line"></div>
<div class="line">    glUniformMatrix4fv(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#afbb3742f444abb100aa2b9743b5a86aa">projectionLocation</a>, 1, GL_FALSE, <a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#ac9131354de4b011211d3a2a2c796053d">projectionMatrix</a>);</div>
<div class="line">    glUniformMatrix4fv(<a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#ae185c1db995cde0f9bb86eccd6bb0f51">modelViewLocation</a>, 1, GL_FALSE, <a class="code" href="tutorials_2_asset_loading_2jni_2_native_8cpp.html#a0fc38eb2bf36959002aa2fc71cf6bc44">modelViewMatrix</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Use the index data loaded from the Open Asset Importer. */</span></div>
<div class="line">    glDrawElements(GL_TRIANGLES, <a class="code" href="gl2ext_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.size(), GL_UNSIGNED_SHORT, &amp;<a class="code" href="gl2ext_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>[0]);</div>
</div><!-- fragment --><p> And there you have it, now instead of specifying your models manually, you can load them from your favourite modeling software. This means that you can create, edit, and fine tune your models in a 3D modeling application and then import directly into your application. The Open Asset Importer supports around 40 different import formats, including all the most popular one, so it should cover most assets you might want to use.</p>
<h1><a class="anchor" id="assetLoadingBuildRun"></a>
Building and Running the Application</h1>
<p>Follow the <a class="el" href="getting_started_guide.html">Getting Started Guide</a> from <a class="el" href="getting_started_guide.html#gettingStartedGuideBuildingTheSamples">Building Android samples</a> onwards to build and run the application.</p>
<h1><a class="anchor" id="assetLoadingNextSteps"></a>
Next Steps</h1>
<p>You can extend this sample to load normals and textures as well. The <a class="el" href="texture_cube.html">Texture Cube</a> and <a class="el" href="lighting.html">Lighting</a> may be useful here. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">
        <a class="copyright" href="http://www.arm.com/">(C) ARM Ltd. 2017</a>
    </li>
  </ul>
</div>
</body>
</html>
