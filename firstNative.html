<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenGL ES SDK for Android: First Android Native Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function()
{ (i[r].q=i[r].q||[]).push(arguments)}
,i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35797182-1', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="top_banner.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenGL ES SDK for Android
<span id="armdevcenter"><a href="https://developer.arm.com/">ARM Developer Center</a></span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('firstNative.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">First Android Native Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An introduction and walkthrough of Android native applications.</p>
<h1><a class="anchor" id="firstNativeIntroduction"></a>
Introduction</h1>
<p>The source for this sample can be found in the folder of the SDK.</p>
<p>This guide will talk you through creating your first Android Native Application. It is assumed that you have already completed the <a class="el" href="gettingStartedGuide.html">Getting Started Guide</a> and have run a Google sample application on your device.</p>
<p>The steps involved are relatively straight forward but this guide will form the basis of all other tutorials in the SDK. We will introduce you to both the Java side and the native side of your application and write a simple application that uses both.</p>
<h1><a class="anchor" id="firstNativeBasicApplicationFlow"></a>
Basic Application Flow</h1>
<p>An Android application is usually split up into two parts: the standard Android side and the native side. In the standard Android side, that is written in Java, you set up the surface that is needed to draw your graphics and also do any other application specific setup. The native side is where you put all your code that will render your scene. Typically the native side of your application will be written in either C or C++.</p>
<h1><a class="anchor" id="firstNativeCreatingNewProject"></a>
Creating A New Project</h1>
<p>The first thing you need to do is to create your project that will be your application. Open up Eclipse and then click <em>File -&gt; New Project</em>. From the selection that appears click <em>Android</em> and then <em>Android Application Project</em>. Once this is done click on the <em>Next</em> button.</p>
<p>You should then be taken to a new screen that provides 3 text boxes that needed to be filled in. For both the <em>Application Name</em> and <em>Project</em> write <b>FirstNative</b>. The package name by convention should be the website of your company backwards and then the application name for example arm.com.malideveloper.openglessdk.firstnative, but it can be anything you want as long as there are some fullstops included. So for now lets use <b>arm.com.malideveloper.openglessdk.firstnative</b>.</p>
<p>For the drop down selection boxes make sure the <em>Minimum Required SDK</em> is <b>API8:Android 2.2(Froyo)</b> but all the other options can be anything you want. When you are done selecting options click the <em>Next</em> button. On the next screen that appears, untick the <em>Create custom launcher</em> icon, as for this example we will skip over this step. Press the <em>Next</em> button 2 more times, change the <em>Activity Name</em> to <b>FirstNative</b> and then click <em>Finish</em>.</p>
<p>Eclipse should now have created a dummy application for you. You should be able to build this and run it on a device. To do this make sure your device is plugged in and then right click on FirstNative in the Package Explorer* view. From the list select <em>Build Project</em>. Do these steps twice to generate the apk file. Now click on <em>Run</em> and then from the box that appears select the device you want to run your application on. Then click <em>OK</em>. The application should now be running on your device. At the moment this won't be very exciting.</p>
<h1><a class="anchor" id="firstNativeCreatingAppropriateFiles"></a>
Creating the Appropriate Files for our Project</h1>
<p>This program is going to consist of two Java files and one C file. The first Java file has already been created and is called <a class="el" href="_first_native_8java.html">FirstNative.java</a>. As mentioned before, this holds the first function that is run in your application. The second is going to act as the interface between the Java side and the native side of the application. To create this we need to right click on FirstNative and select <em>New -&gt; File</em>. From the directory structure that appears navigate yourself to <em>FirstNative-&gt;com-&gt;arm-&gt;malideveloper-&gt;openglessdk-&gt;firstnative</em> and then enter the filename NativeLibrary.java** and then click <em>Finish</em>. NativeLibrary.java should now be added to the same location as <a class="el" href="_first_native_8java.html">FirstNative.java</a>.</p>
<p>Now as you have already seen the application runs fine without having a native side. In fact most applications on the Android Marketplace don't have a native side. So we need to tell Eclipse to add one to our project. Right click on the project and then select <em>Android Tools</em>. From there click the option that says <em>Add Native Support</em>. A box should appear asking what you would like the native library to be called. Just enter <b>Native</b> and click <em>Finish</em>. This should create a new folder in your project labelled jni and inside there should be Native.cpp.</p>
<h1><a class="anchor" id="firstNativeFirstNative"></a>
FirstNative Class</h1>
<p>As mentioned before, this class holds the first function to be called in your application. It also deals with most of the interactions directly with Android. Here are the first few lines of code:</p>
<div class="fragment"><div class="line"><span class="keyword">package </span>com.arm.malideveloper.openglessdk.firstnative;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div></div><!-- fragment --><p> The first line should be included in all of your Java source files. This tells your application which package this Java file belongs too. The next lines refer to files you also need to import for your application to work. As this class is going to be the starting point of your activity you need to import the Activity class. Note the logging import helps with debugging in your application. It enables printf like debugging in your Android application.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>FirstNative <span class="keyword">extends</span> Activity</div><div class="line">{</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> String LOGTAG = <span class="stringliteral">&quot;FirstNative&quot;</span>;</div></div><!-- fragment --><p> Now we proceed with the class definition. As we don't want to start our class from scratch we say that it extends the Activity class. Which indicates to Android this is the starting class. Inside this class we have a member variables. This member variable is a string that we use when we are providing logging information.</p>
<div class="fragment"><div class="line">        @Override <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState)</div><div class="line">        {</div><div class="line">                super.onCreate(savedInstanceState);             </div><div class="line">                Log.d(LOGTAG, <span class="stringliteral">&quot;On Create Method Calling Native Library&quot;</span>);</div><div class="line">                NativeLibrary.init();</div><div class="line">        }</div></div><!-- fragment --><p> This is the first function in our class and it is also the first function that gets called in our application. As we are not interested in most of the setup ourself we call the onCreate method of the super class. We then add our first debug statement. This will output the string 'On Create method Calling native Library' which will be visible in LogCat.</p>
<p>Logcat is the Android logging tool and it is very useful. To view it you just need to go into the folder that you installed the Android SDK Bundle from the getting started guide. In there should be a tool called adb. In your shell or command line type:</p>
<div class="fragment"><div class="line">adb logcat</div></div><!-- fragment --><p>There are multiple levels of logging. The one we used in this example is the debugging level but there are also info level, error level and various others. It is something well worth looking into if you get the chance. The final line of onCreate calls into the native side of the application using the NativeLibrary class that we are yet to write.</p>
<div class="fragment"><div class="line">        @Override <span class="keyword">protected</span> <span class="keywordtype">void</span> onPause()</div><div class="line">        {</div><div class="line">                super.onPause();</div><div class="line">        }</div><div class="line">        </div><div class="line">        @Override <span class="keyword">protected</span> <span class="keywordtype">void</span> onResume()</div><div class="line">        {</div><div class="line">                super.onResume();</div><div class="line">        }</div></div><!-- fragment --><p> The final two functions in this class are the onPause and onResume functions. As Android is a multitasking environment. Your application maybe interrupted by the OS at any time. So we need to define what happens to the application when the OS asks the application to pause and then what to do when it resumes. As our app is relatively simple there isn't much needed to be done. We just call the equivalent method in the super class in each case.</p>
<h1><a class="anchor" id="firstNativeTheLibrary"></a>
The Library</h1>
<p>The other Java file we need to create is the interface between the Java side of our application and the native C side. This file will load in the native library that holds all of our code and will also define the functions that will be found in the native library.</p>
<div class="fragment"><div class="line"><span class="keyword">package </span>com.arm.malideveloper.openglessdk.firstnative;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>NativeLibrary</div><div class="line">{</div><div class="line">        <span class="keyword">static</span></div><div class="line">        {</div><div class="line">                System.loadLibrary(<span class="stringliteral">&quot;Native&quot;</span>);</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> native <span class="keywordtype">void</span> <a class="code" href="classcom_1_1arm_1_1malideveloper_1_1openglessdk_1_1firstnative_1_1_native_library.html#a2aca175d793c80051085bc0c6bb8fdfc">init</a>();</div><div class="line">}</div></div><!-- fragment --><p> As with all of the Java files you need to add the package that this file will be part of. The first real line of note is the System.loadLibrary("Native") which loads our native library from the system. The only other part of this class is the function prototype of the function that can be found in the native library.</p>
<h1><a class="anchor" id="firstNativeNativeCode"></a>
Native Code</h1>
<p>Now that we have created the Android activity and the interface between the Java code and the native code it is time to write some the native portion of the code. As this is our first example this will be kept relatively simple but in future this will house all of our scene setup as well at functions that will actually render the scene.</p>
<p>As with the previous tutorial we create all necessary files for native development by right clicking on our project in the project explorer. Select <em>Add Native Support</em> and then make sure the library name is called Native** and click <em>Finish</em>. Now lets edit our Native.cpp file (in the jni folder in Eclipse).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;jni.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;android/log.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define LOG_TAG &quot;libNative&quot;</span></div><div class="line"><span class="preprocessor">#define LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, __VA_ARGS__)</span></div></div><!-- fragment --><p> As you can see things have gone well and truly into the C Programming language. We start off by including two files. The first is jni.h which allows C to know and use the Java interface. The second is the Android logging headers so we can include log statements like we did in the Java side. To make this easier to use we have included some #defines.</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span></div><div class="line">{</div><div class="line">        JNIEXPORT <span class="keywordtype">void</span> JNICALL <a class="code" href="tutorials_2_first_native_2jni_2_native_8cpp.html#acd9a76cd00466e8dbbbaec940d787e3d">Java_com_arm_malideveloper_openglessdk_firstnative_NativeLibrary_init</a>(</div><div class="line">                        JNIEnv * env, jobject obj);</div><div class="line"></div><div class="line">};</div></div><!-- fragment --><p> We now define the function prototypes for the functions referenced to in Java that we will define in this file. Note each function that is called from the Java side will include a JNIEnv parameter and a jobject parameter. For now we don't need to do anything with them. Just know that they must be included.</p>
<div class="fragment"><div class="line">JNIEXPORT <span class="keywordtype">void</span> JNICALL <a class="code" href="tutorials_2_first_native_2jni_2_native_8cpp.html#acd9a76cd00466e8dbbbaec940d787e3d">Java_com_arm_malideveloper_openglessdk_firstnative_NativeLibrary_init</a>(</div><div class="line">                JNIEnv * env, jobject obj)</div><div class="line">{</div><div class="line">        <a class="code" href="_astc_textures_8h.html#a5512e59d578a380a441a70256af997d0">LOGI</a>(<span class="stringliteral">&quot;Hello From the Native Side!!&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p> This is the only function we define and in typical "hello world" style, we just print a message. This is the only native side function we need to write at the moment.</p>
<h1><a class="anchor" id="firstNativeBuildRun"></a>
Building and Running the Application</h1>
<p>Follow the <a class="el" href="gettingStartedGuide.html">Getting Started Guide</a> from <a class="el" href="gettingStartedGuide.html#gettingStartedGuideBuildingTheSamples">Building Android samples</a> onwards to build and run the application.</p>
<h1><a class="anchor" id="firstNativeNextSteps"></a>
Next Steps</h1>
<p>Now move on to <a class="el" href="introductionToShaders.html">Introduction to shaders</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">
        <a class="copyright" href="http://www.arm.com/">(C) ARM Ltd. 2017</a>
    </li>
  </ul>
</div>
</body>
</html>
